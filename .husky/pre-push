#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push hook..."
echo "ğŸ“¦ Building project to ensure it compiles correctly..."

# Save the current branch name
current_branch=$(git symbolic-ref --short HEAD)
echo "ğŸ”€ Current branch: $current_branch"

# Check if npm is installed
if ! command -v npm > /dev/null; then
    echo "âŒ npm is not installed or not in PATH. Please install npm to proceed."
    exit 1
fi

# Skip build for specific branches (optional)
if [[ "$current_branch" == "main" || "$current_branch" == "master" ]]; then
    echo "ğŸ›‘ Skipping build check for $current_branch branch."
    exit 0
fi

# Run build and capture output
output=$(npm run build 2>&1)
exit_code=$?

# Print the output
echo "$output"

# Save build logs for debugging
echo "$output" > build.log

if [ $exit_code -eq 0 ]; then
    echo "âœ… Build completed successfully."
else
    echo "âŒ Build failed. Please fix the build errors before pushing."
    echo "ğŸ“œ Check build.log for details."
    exit 1
fi
